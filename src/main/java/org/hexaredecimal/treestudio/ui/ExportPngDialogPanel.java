package org.hexaredecimal.treestudio.ui;

import java.awt.event.ActionListener;
import java.awt.event.ItemEvent;
import java.io.File;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import org.hexaredecimal.treestudio.utils.FileFilter;

/**
 *
 * @author hexaredecimal
 */
public class ExportPngDialogPanel extends javax.swing.JPanel {

	/**
	 * Creates new form ExportDialogPanel
	 */
	public ExportPngDialogPanel() {
		initComponents();
		transparentBg.addItemListener(e -> {
			setTransparent = e.getStateChange() == ItemEvent.SELECTED;
		});

		exportPathTextField.addActionListener(e -> {
			selectedPath = exportPathTextField.getText();
		});

		pickPngDir.addActionListener(action -> {
			JFileChooser chooser = new JFileChooser(".");
			chooser.setFileFilter(FileFilter.pngFilter);
			chooser.setDialogTitle("Save Tree as PNG");
			if (chooser.showSaveDialog(this) == JFileChooser.APPROVE_OPTION) {
				var file = chooser.getSelectedFile();

				if (file.exists()) {
					var selected = JOptionPane.showConfirmDialog(this, "Replace file?", "Replace " + file.getAbsolutePath(), JOptionPane.OK_CANCEL_OPTION);
					if (selected != JOptionPane.OK_OPTION) {
						return;
					}
				}
				
				if (!file.getName().toLowerCase().endsWith(".png")) {
					file = new File(file.getAbsolutePath() + ".png");
				}
				selectedPath = file.getAbsolutePath();
				exportPathTextField.setText(selectedPath);
			}

		});

	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
  // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
  private void initComponents() {

    jLabel1 = new javax.swing.JLabel();
    jPanel1 = new javax.swing.JPanel();
    jPanel2 = new javax.swing.JPanel();
    jLabel2 = new javax.swing.JLabel();
    exportPathTextField = new javax.swing.JTextField();
    pickPngDir = new javax.swing.JButton();
    cancelButton = new javax.swing.JButton();
    okButton = new javax.swing.JButton();
    transparentBg = new javax.swing.JCheckBox();
    errorLabel = new javax.swing.JLabel();

    jLabel1.setFont(new java.awt.Font("Monospaced", 0, 18)); // NOI18N
    jLabel1.setText("Export");

    jPanel1.setBackground(new java.awt.Color(204, 204, 204));
    jPanel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());

    javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
    jPanel1.setLayout(jPanel1Layout);
    jPanel1Layout.setHorizontalGroup(
      jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGap(0, 9, Short.MAX_VALUE)
    );
    jPanel1Layout.setVerticalGroup(
      jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGap(0, 0, Short.MAX_VALUE)
    );

    jPanel2.setBackground(new java.awt.Color(204, 204, 204));
    jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder());

    javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
    jPanel2.setLayout(jPanel2Layout);
    jPanel2Layout.setHorizontalGroup(
      jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGap(0, 0, Short.MAX_VALUE)
    );
    jPanel2Layout.setVerticalGroup(
      jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGap(0, 11, Short.MAX_VALUE)
    );

    jLabel2.setText("Export Path");
    jLabel2.setToolTipText("");

    pickPngDir.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icons/export.png"))); // NOI18N
    pickPngDir.setText("Select Path");

    cancelButton.setText("Cancel");

    okButton.setText("Ok");

    transparentBg.setText("Transparent Background");

    errorLabel.setForeground(new java.awt.Color(255, 102, 102));
    errorLabel.setText("*");
    errorLabel.setEnabled(false);

    javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
    this.setLayout(layout);
    layout.setHorizontalGroup(
      layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(layout.createSequentialGroup()
        .addContainerGap()
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
          .addGroup(layout.createSequentialGroup()
            .addComponent(jLabel1)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addContainerGap())
          .addGroup(layout.createSequentialGroup()
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
              .addGroup(layout.createSequentialGroup()
                .addComponent(jLabel2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(exportPathTextField, javax.swing.GroupLayout.DEFAULT_SIZE, 214, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pickPngDir, javax.swing.GroupLayout.PREFERRED_SIZE, 117, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
              .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addComponent(errorLabel)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(okButton)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cancelButton))
              .addComponent(transparentBg, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))))
    );
    layout.setVerticalGroup(
      layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(layout.createSequentialGroup()
        .addContainerGap()
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
          .addComponent(jLabel1)
          .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
          .addGroup(layout.createSequentialGroup()
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
              .addComponent(jLabel2)
              .addComponent(exportPathTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
              .addComponent(pickPngDir))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(transparentBg)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
              .addComponent(cancelButton)
              .addComponent(okButton)
              .addComponent(errorLabel))
            .addContainerGap())
          .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
    );
  }// </editor-fold>//GEN-END:initComponents

	private String selectedPath;
	private boolean setTransparent;

	public String getSelectedPath() {
		return selectedPath;
	}

	public boolean isSetTransparent() {
		return setTransparent;
	}

	public void addOnDoneListener(ActionListener onDone) {
		this.okButton.addActionListener(e -> {
			if (selectedPath == null || selectedPath.isEmpty()) {
				errorLabel.setEnabled(true);
				errorLabel.setText("Export path is required");
				return;
			}

			errorLabel.setEnabled(false);
			errorLabel.setText("");
			onDone.actionPerformed(e);
		});

	}

	public void addOnCancelListener(ActionListener onCancel) {
		this.cancelButton.addActionListener(onCancel);
	}




  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JButton cancelButton;
  private javax.swing.JLabel errorLabel;
  private javax.swing.JTextField exportPathTextField;
  private javax.swing.JLabel jLabel1;
  private javax.swing.JLabel jLabel2;
  private javax.swing.JPanel jPanel1;
  private javax.swing.JPanel jPanel2;
  private javax.swing.JButton okButton;
  private javax.swing.JButton pickPngDir;
  private javax.swing.JCheckBox transparentBg;
  // End of variables declaration//GEN-END:variables
}
